=== modified file 'template/en/default/admin/custom_fields/edit.html.tmpl'
--- template/en/default/admin/custom_fields/edit.html.tmpl	2010-08-27 03:27:08 +0000
+++ template/en/default/admin/custom_fields/edit.html.tmpl	2012-01-19 17:30:50 +0000
@@ -140,7 +140,9 @@
         <th>&nbsp;</th>
         <td>
           <a href="editvalues.cgi?field=[% field.name FILTER uri %]">Edit
-            legal values for this field</a>.
+            legal values for this field</a>.<br>
+          <a href="page.cgi?id=fieldgroups.html&field=[% field.name FILTER uri %]">Edit
+            legal groups for this field</a>.
         </td>
 
         <th>

=== modified file 'template/en/default/admin/fieldvalues/create.html.tmpl'
--- template/en/default/admin/fieldvalues/create.html.tmpl	2010-02-02 01:34:26 +0000
+++ template/en/default/admin/fieldvalues/create.html.tmpl	2012-01-19 17:29:11 +0000
@@ -86,6 +86,7 @@
         </td>
       </tr>
     [% END %]
+    [% Hook.process('end_parameters') %]
   </table>
   <input type="submit" id="create" value="Add">
   <input type="hidden" name="action" value="new">

=== modified file 'template/en/default/admin/fieldvalues/edit.html.tmpl'
--- template/en/default/admin/fieldvalues/edit.html.tmpl	2010-05-14 14:25:05 +0000
+++ template/en/default/admin/fieldvalues/edit.html.tmpl	2012-01-20 13:08:21 +0000
@@ -100,6 +100,7 @@
            [% END %]
       </td>
     </tr>
+    [% Hook.process('end_parameters') %]
   </table>
   <input type="hidden" name="value" value="[% value.name FILTER html %]">
   <input type="hidden" name="action" value="update">

=== modified file 'template/en/default/admin/fieldvalues/list.html.tmpl'
--- template/en/default/admin/fieldvalues/list.html.tmpl	2010-07-22 22:46:02 +0000
+++ template/en/default/admin/fieldvalues/list.html.tmpl	2012-01-20 15:59:23 +0000
@@ -50,6 +50,10 @@
        name => "sortkey"
        heading => "Sortkey"
      },
+     { 
+       name => "group"
+       heading => "Group"
+     },
      {
        name => "isactive"
        heading => "Enabled for $terms.bugs"
@@ -83,7 +87,11 @@
        }
     %]
   [% END %]
-
+    [% overrides.group.name.${check_value.name} = {
+         override_content => 1
+         content => "$check_value.optgroup.name"
+       }
+    %]
 [% END %]
 
 [% PROCESS admin/table.html.tmpl

=== modified file 'template/en/default/bug/field.html.tmpl'
--- template/en/default/bug/field.html.tmpl	2012-01-11 23:13:05 +0000
+++ template/en/default/bug/field.html.tmpl	2012-01-19 17:29:11 +0000
@@ -119,21 +119,28 @@
           [% ELSE %]
             [% legal_values = field.legal_values %]
           [% END %]
-          [% FOREACH legal_value = legal_values %]
-            [% NEXT IF NOT legal_value.is_active AND NOT value.contains(legal_value.name).size %]
-            <option value="[% legal_value.name FILTER html %]"
-                    id="v[% legal_value.id FILTER html %]_
-                        [%- field.name FILTER html %]"
-              [%# We always show selected values, even if they should be
-                # hidden %]
-              [% IF value.contains(legal_value.name).size %]
-                selected="selected"
-              [% ELSIF bug AND !legal_value.is_visible_on_bug(bug) %]
-                class="bz_hidden_option" disabled="disabled"
-              [% END %]>
-              [%- display_value(field.name, legal_value.name) FILTER html ~%]
-            </option>
-          [% END %]
+          [%- FOREACH g = field.legal_groups %]
+            [% NEXT IF NOT g.group_values.size %]
+            <optgroup [% ' label="' _ g.name _ '"' UNLESS g.name == 'Default' %]>
+                [%- FOREACH legal_value = g.group_values %]
+                  [% NEXT IF NOT legal_value.is_active 
+                                    AND NOT value.contains(legal_value.name).size
+                                    AND NOT legal_values.contains(legal_value).size %]
+                  <option value="[% legal_value.name FILTER html %]"
+                       id="v[% legal_value.id FILTER html %]_
+                            [%- field.name FILTER html %]"
+                  [%# We always show selected values, even if they should be
+                    # hidden %]
+                  [% IF value.contains(legal_value.name).size %]
+                    selected="selected"
+                  [% ELSIF bug AND !legal_value.is_visible_on_bug(bug) %]
+                   class="bz_hidden_option" disabled="disabled"
+                  [% END %]>
+                  [%- display_value(field.name, legal_value.name) FILTER html ~%]
+                </option>
+              [%- END %]
+            </optgroup>
+            [%- END %]
         </select>
         [%# When you pass an empty multi-select in the web interface,
           # it doesn't appear at all in the CGI object. Instead of

=== modified file 'template/en/default/global/messages.html.tmpl'
--- template/en/default/global/messages.html.tmpl	2011-11-26 00:13:18 +0000
+++ template/en/default/global/messages.html.tmpl	2012-01-20 16:04:28 +0000
@@ -328,6 +328,10 @@
           <li>Sortkey updated to 
             <em>[% changes.sortkey.1 FILTER html %]</em>.</li>
         [% END %]
+        [% IF changes.optgroup_id %]
+        	<li>Value now belongs to option group
+        	  <em>[% value.optgroup.name FILTER html %]</em>.</li>
+        [% END %]
         [% IF changes.visibility_value_id %]
           [% IF value.visibility_value.defined %]
             <li>It only appears when 

